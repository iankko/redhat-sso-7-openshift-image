schema_version: 1
name: eap
description: "Installs base EAP to the image"
version: '1.0'

modules:
      install:
          ### Image :: Standalone ####
          - name: eap-74-galleon-latest
          - name: jboss.container.eap.setup
          - name: eap-install-cleanup

          ### Image :: OpenShift ####
          # Order of the modules installation below matters!!! DO NOT CHANGE it unless
          # you first verified the image with changed order still works correctly
          # Common modules from the main CE cct_module repository
          - name: jboss.container.maven
            version: "8.2.3.6"
            # Remove to reduce count of layers
            #- name: jboss.container.maven.module
            #version: "3.6"
          - name: os-eap-python
            version: '3.6'
          - name: jboss.container.jolokia
            version: '8.2'
          - name: jboss.container.prometheus
            version: '8.2'
          - name: dynamic-resources
          - name: jboss.container.eap.s2i.galleon
          - name: jboss.container.eap.galleon
          - name: jboss.container.eap.galleon.config.ee
          - name: jboss.container.eap.galleon.build-settings
            version: "osbs"
          - name: jboss.container.eap.openshift.modules
          # Remove to reduce count of layers
          # - name: jboss.container.java.jvm.bash
          # Actions performed by RH-SSO nss_wrapper module
          # - name: jboss.container.eap.launch
          - name: jboss.container.wildfly.launch.admin
          - name: jboss.container.wildfly.launch.access-log-valve
          - name: jboss.container.wildfly.launch-config.config
          - name: jboss.container.wildfly.launch-config.os
          - name: jboss.container.wildfly.launch.datasources
          - name: jboss.container.wildfly.launch.extensions
          - name: jboss.container.wildfly.launch.json-logging
          - name: jboss.container.wildfly.launch.jgroups
            # The following two were commented out to reduce count of layers
            # (IOW prevent docker: 'max depth exceeded' error)
            # - name: jboss.container.wildfly.launch.filters
            # - name: jboss.container.wildfly.launch.logger-category
          - name: jboss.container.wildfly.launch.os.node-name
          - name: jboss.container.wildfly.launch.deployment-scanner
          - name: jboss.container.wildfly.launch.keycloak
          - name: jboss.container.wildfly.launch.https
          - name: jboss.container.wildfly.launch.security-domains
          - name: jboss.container.wildfly.launch.elytron
          - name: jboss.container.wildfly.launch.port-offset
            # The following four were commented out to reduce count of layers
            # (IOW to prevent docker: 'max depth exceeded' error)
            # - name: jboss.container.wildfly.launch.resource-adapters
            # - name: jboss.container.wildfly.launch.messaging
            # - name: jboss.container.wildfly.launch.statefulset
            # - name: jboss.container.wildfly.galleon.fp-content.jolokia
          # needs to be before fp-content.keycloak to copy modules used to generate galleon packages
          - name: os-eap70-sso
          - name: jboss.container.wildfly.galleon.fp-content.keycloak
          - name: jboss.container.wildfly.galleon.fp-content.java
          - name: jboss.container.wildfly.galleon.fp-content.config
          - name: jboss.container.wildfly.galleon.fp-content.mvn
          - name: jboss.container.wildfly.galleon.fp-content.ejb-tx-recovery
          - name: os-eap-probes
            version: "3.0"
          # We keep this one to only advertise that hawkular is no more supported.
          # Remove the following two to reduce the count of layers
          # - name: jboss.container.eap.hawkular
          # - name: jboss.container.util.logging.bash
          # Remove following two to reduce count of layers
          # - name: jboss.container.eap.prometheus.config
          # - name: os-eap-txnrecovery.run
          #  version: 'python3'

          # At this point, all scripts must have been added to JBOSS_HOME and to custom galleon packages location
          #- name: jboss.container.wildfly.galleon.build-feature-pack

          # Use RH-SSO copy rather than the 'jboss.container.wildfly.galleon.build-feature-pack'
          # to avoid downloading 'offliner.jar' and 'offliner.txt' artifact every time
          - name: sso.copy.jboss.container.wildfly.galleon.build-feature-pack
            version: '0.24.0'
          - name: jboss.container.wildfly.galleon.provision-server
          - name: jboss.container.eap.final-setup

#          - name: jboss.container.eap.s2i.bash
#          - name: jboss.container.java.jvm.bash
#          - name: jboss.container.jolokia.bash
#          - name: jboss.container.wildfly.standalone-conf.java
#          - name: jboss.container.wildfly.standalone-conf.jolokia
#          - name: os-eap7-ping
#          - name: jboss.container.java.jvm.bash
#          - name: os-eap-launch
#          - name: os-eap7-launch
#          - name: os-eap-datasource
#            version: '1.0'
#          - name: jboss.eap.cd.logging
#          - name: jboss.eap.config.jgroups
#          - name: jboss.eap.config.elytron
#          - name: os-eap-probes
#            version: '3.0'
#          - name: jboss.container.maven.35.bash
#            version: '3.5'
#          - name: os-eap-hawkular
#          - name: os-eap-deployment-scanner

execute:
    - script: install-eap-one-offs.sh

# All EAP one-offs artifacts must be prefixed with "eap-one-off-" prefix and suffixed with in ".zip".
# Ensure that only one-offs for the INSTALLED version of EAP are present, and comment all of them
# that are obsoleted.
# artifacts:
#
#      KEYCLOAK-13487 "jbeap-18807.zip" is obsolete in EAP-7.3.1 / RH-SSO 7.5.1, deprecate it
#
#      - md5: 1b6036cfcde2cf1dc05c2eb6eca228ff
#        name: jbeap-18807.zip
#        target: eap-one-off-jbeap-18807.zip
#        url: http://$DOWNLOAD_SERVER/devel/candidates/JBSSO/JBSSO-7.5.0.CR2/jbeap-18807.zip
